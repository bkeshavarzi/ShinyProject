runApp('RProject/ShinyApp')
runApp('RProject/ShinyApp')
runApp('RProject/ShinyApp')
runApp('RProject/ShinyApp')
library(tidyverse)
library(googleVis)
library(DT)
rm(list=ls())
setwd("C:\\Users\\behroozk\\Documents\\RProject\\ShinyApp\\")
rm(list=ls())
df_pavement_SHRP=read.csv("PavementStructure_SHRP_Info.csv",stringsAsFactors = FALSE)
df_pavement_info=read.csv("PavementStructure_Pavement_Info.csv")
Out_of_US=c("Alberta","British Columbia","New Brunswick","Newfoundland","Nova Scotia","Ontario","Prince Edward Island","Quebec","Saskatchewan","Manitoba")
df_pavement_info=df_pavement_info %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>%select(STATE_CODE_EXP,SHRP_ID,CONSTRUCTION_NO,LAYER_NO,LAYER_TYPE,LAYER_TYPE_EXP,REPR_THICKNESS)
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>% select(STATE_CODE_EXP,STATE_CODE,SHRP_ID,START_DATE,END_DATE)
df_pavement_info$LAYER_TYPE_EXP=str_replace(df_pavement_info$LAYER_TYPE_EXP,"layer","")
df_pavement_info=df_pavement_info %>% filter(!is.na(REPR_THICKNESS))
df_pavement_SHRP$START_DATE=as.Date(df_pavement_SHRP$START_DATE,"%m/%d/%Y")
df_pavement_SHRP$END_DATE=as.Date(df_pavement_SHRP$END_DATE,"%m/%d/%Y")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP$END_DATE=str_replace(df_pavement_SHRP$END_DATE,"2050","2005")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(duration<0))
df_pavement_SHRP=df_pavement_SHRP %>% group_by(STATE_CODE_EXP,STATE_CODE,SHRP_ID) %>% summarise(syear=min(as.integer(substr(START_DATE,1,4))),eyear=max(as.integer(substr(END_DATE,1,4))),duration=sum(duration))
df_pavement_info_AC=df_pavement_info %>% filter(LAYER_TYPE=='AC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
df_pavement_info_PC=df_pavement_info %>% filter(LAYER_TYPE=='PC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
pavement_data_AC=inner_join(df_pavement_SHRP,df_pavement_info_AC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
pavement_data_PC=inner_join(df_pavement_SHRP,df_pavement_info_PC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
df_pavement_info$CN=factor(df_pavement_info$CONSTRUCTION_NO)
df_gps=read.csv('GPS.csv',stringsAsFactors = FALSE)[,c(1,2,3,4,5,9)]
df_gps=df_gps %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_gps$ELEVATION=round(df_gps$ELEVATION,digits=2)
state_list=unique(df_pavement_info$STATE_CODE_EXP)
state_list=sort(state_list,decreasing = FALSE)
layer_type_list=sort(unique(df_pavement_info$LAYER_TYPE))
df_mera_shrp=read.csv("MERA_SHRP.csv",stringsAsFactors = FALSE)
df_mera_temp_month=read.csv("MERRA_TEMP_MONTH.csv",stringsAsFactors = FALSE)
df_mera_temp_month=df_mera_temp_month %>% select(!FREEZE_INDEX & !FREEZE_THAW)
df_mera_temp_month=df_mera_temp_month %>% mutate(Tave_F=1.8*TEMP_AVG+32)
df_mera_temp_month=df_mera_temp_month %>% select(!TEMP_AVG & !TEMP_MEAN_AVG)
df_temperature=inner_join(df_mera_shrp,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_temperature=inner_join(df_temperature,df_mera_temp_month,by="MERRA_ID")
temperature_state_list=sort(unique(df_temperature$STATE_CODE_EXP),decreasing = FALSE)
temperature_year_list=sort(unique(df_temperature$YEAR),decreasing = FALSE)
temperature_month_number_list=sort(unique(df_temperature$MONTH),decreasing = FALSE)
temperature_month_list=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')
df_traffic=read.csv("Traffic.csv",stringsAsFactors = FALSE)[,seq(1,6)]
df_traffic=df_traffic %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_traffic=inner_join(df_traffic,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_traffic=df_traffic %>% mutate(LatLong=paste(LATITUDE,LONGITUDE,sep=":"))
colnames(df_traffic)[6]="ESAL"
traffic_state=sort(unique(df_traffic$STATE_CODE_EXP),decreasing = FALSE)
traffic_year=sort(unique(df_traffic$YEAR),decreasing = FALSE)
traffic_SHRP=sort(unique(df_traffic$SHRP_ID))
df_IRI=read.csv("IRI.csv",stringsAsFactors = FALSE)
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US)) %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH,CONSTRUCTION_NO)
df_IRI=df_IRI %>% mutate(IRI_ave=ave(IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH))
df_IRI$VISIT_DATE=as.Date(df_IRI$VISIT_DATE,format ="%m/%d/%Y")
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID) %>% arrange(VISIT_DATE,CONSTRUCTION_NO)
df_IRI=df_IRI %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO,IRI_ave)
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO) %>% summarise(IRI=mean(IRI_ave),Date=min(VISIT_DATE))
df_IRI=df_IRI %>% filter(!is.na(IRI))
View(df_IRI)
View(df_IRI)
df_IRI=df_IRI %>% select(!VISIT_DATE)
df_IRI=df_IRI %>% select(!VISIT_DATE)
library(tidyverse)
library(googleVis)
library(DT)
rm(list=ls())
setwd("C:\\Users\\behroozk\\Documents\\RProject\\ShinyApp\\")
rm(list=ls())
df_pavement_SHRP=read.csv("PavementStructure_SHRP_Info.csv",stringsAsFactors = FALSE)
df_pavement_info=read.csv("PavementStructure_Pavement_Info.csv")
Out_of_US=c("Alberta","British Columbia","New Brunswick","Newfoundland","Nova Scotia","Ontario","Prince Edward Island","Quebec","Saskatchewan","Manitoba")
df_pavement_info=df_pavement_info %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>%select(STATE_CODE_EXP,SHRP_ID,CONSTRUCTION_NO,LAYER_NO,LAYER_TYPE,LAYER_TYPE_EXP,REPR_THICKNESS)
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>% select(STATE_CODE_EXP,STATE_CODE,SHRP_ID,START_DATE,END_DATE)
df_pavement_info$LAYER_TYPE_EXP=str_replace(df_pavement_info$LAYER_TYPE_EXP,"layer","")
df_pavement_info=df_pavement_info %>% filter(!is.na(REPR_THICKNESS))
df_pavement_SHRP$START_DATE=as.Date(df_pavement_SHRP$START_DATE,"%m/%d/%Y")
df_pavement_SHRP$END_DATE=as.Date(df_pavement_SHRP$END_DATE,"%m/%d/%Y")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP$END_DATE=str_replace(df_pavement_SHRP$END_DATE,"2050","2005")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(duration<0))
df_pavement_SHRP=df_pavement_SHRP %>% group_by(STATE_CODE_EXP,STATE_CODE,SHRP_ID) %>% summarise(syear=min(as.integer(substr(START_DATE,1,4))),eyear=max(as.integer(substr(END_DATE,1,4))),duration=sum(duration))
df_pavement_info_AC=df_pavement_info %>% filter(LAYER_TYPE=='AC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
df_pavement_info_PC=df_pavement_info %>% filter(LAYER_TYPE=='PC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
pavement_data_AC=inner_join(df_pavement_SHRP,df_pavement_info_AC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
pavement_data_PC=inner_join(df_pavement_SHRP,df_pavement_info_PC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
df_pavement_info$CN=factor(df_pavement_info$CONSTRUCTION_NO)
df_gps=read.csv('GPS.csv',stringsAsFactors = FALSE)[,c(1,2,3,4,5,9)]
df_gps=df_gps %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_gps$ELEVATION=round(df_gps$ELEVATION,digits=2)
state_list=unique(df_pavement_info$STATE_CODE_EXP)
state_list=sort(state_list,decreasing = FALSE)
layer_type_list=sort(unique(df_pavement_info$LAYER_TYPE))
df_mera_shrp=read.csv("MERA_SHRP.csv",stringsAsFactors = FALSE)
df_mera_temp_month=read.csv("MERRA_TEMP_MONTH.csv",stringsAsFactors = FALSE)
df_mera_temp_month=df_mera_temp_month %>% select(!FREEZE_INDEX & !FREEZE_THAW)
df_mera_temp_month=df_mera_temp_month %>% mutate(Tave_F=1.8*TEMP_AVG+32)
df_mera_temp_month=df_mera_temp_month %>% select(!TEMP_AVG & !TEMP_MEAN_AVG)
df_temperature=inner_join(df_mera_shrp,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_temperature=inner_join(df_temperature,df_mera_temp_month,by="MERRA_ID")
temperature_state_list=sort(unique(df_temperature$STATE_CODE_EXP),decreasing = FALSE)
temperature_year_list=sort(unique(df_temperature$YEAR),decreasing = FALSE)
temperature_month_number_list=sort(unique(df_temperature$MONTH),decreasing = FALSE)
temperature_month_list=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')
df_traffic=read.csv("Traffic.csv",stringsAsFactors = FALSE)[,seq(1,6)]
df_traffic=df_traffic %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_traffic=inner_join(df_traffic,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_traffic=df_traffic %>% mutate(LatLong=paste(LATITUDE,LONGITUDE,sep=":"))
colnames(df_traffic)[6]="ESAL"
traffic_state=sort(unique(df_traffic$STATE_CODE_EXP),decreasing = FALSE)
traffic_year=sort(unique(df_traffic$YEAR),decreasing = FALSE)
traffic_SHRP=sort(unique(df_traffic$SHRP_ID))
df_IRI=read.csv("IRI.csv",stringsAsFactors = FALSE)
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US)) %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH,CONSTRUCTION_NO)
df_IRI=df_IRI %>% mutate(IRI_ave=ave(IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH))
df_IRI$VISIT_DATE=as.Date(df_IRI$VISIT_DATE,format ="%m/%d/%Y")
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID) %>% arrange(VISIT_DATE,CONSTRUCTION_NO)
df_IRI=df_IRI %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO,IRI_ave)
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO) %>% summarise(IRI=mean(IRI_ave),Date=min(VISIT_DATE))
df_IRI=df_IRI %>% filter(!is.na(IRI))
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(IRI)
View(df)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO,Date)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO) %>% ggplot() %>% geom_point(aes(x=Date,y=IRI,fill=CONSTRUCTION_NO))
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO) %>% ggplot() + geom_point(aes(x=Date,y=IRI,fill=CONSTRUCTION_NO))
df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO) %>% ggplot() + geom_point(aes(x=Date,y=IRI,fill=CONSTRUCTION_NO))
df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO) %>% filter(SHRP_ID==0101)%>% ggplot() + geom_point(aes(x=Date,y=IRI,fill=CONSTRUCTION_NO))
s=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID) %>% arrange(CONSTRUCTION_NO) %>% filter(SHRP_ID==0101)
View(s)
s=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% filter(SHRP_ID==0101)
s=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% filter(SHRP_ID=='0101')
s=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% filter(SHRP_ID=='0101') %>% mutate(day=Date-min(Date))
min_data=min(Date)
min_data=min(s$Date)
min_date=min(s$Date)
min_date
class(min_date)
s$Date-min_date
s=s %>% mutate(day=Date-min_date)
class(s$day)
ggplot(s)+geom_point(aes(x=day,y=IRI))
s$day=as.integer(s$day)
class(s$day)
ggplot(s)+geom_point(aes(x=day,y=IRI))
View(df_pavement_info)
df=df_pavement_info %>% filter(STATE_CODE_EXP=='Alabama'&SHRP_ID=='0101')
View(df)
View(df_IRI)
df=df_IRI %>% filter(STATE_CODE_EXP==input$IRI_state_1&SHRP_ID==input$IRI_shrp) %>% select(Date,CONSTRUCTION_NO,IRI)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama')
View(df)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama'&SHRP_ID=='0101')
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama'&SHRP_ID=='0101') %>% group_by(CONSTRUCTION_NO) %>% summarise(min_date=min(Date),max_date=max(Date))
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama'&SHRP_ID=='0101')
df_min_max=df %>% group_by(CONSTRUCTION_NO) %>% summarise(min_date=min(Date),max_date=max(Date))
View(df_min_max)
fun=function(x){}
fun=function(x){}
fun=function(x){
return x+2
}
myfun <=function(x){
return(x+2)
}
myfun <-function(x){
return (x+2)
}
myfun(4)
x=df %>% apply(CONSTRUCTION_NO, 1, myfun)
x=df %>% apply(CONSTRUCTION_NO, myfun)
x=df %>% apply(df$CONSTRUCTION_NO, myfun)
x=apply(df$CONSTRUCTION_NO, myfun)
x=apply(df$CONSTRUCTION_NO, myfun())
x=apply(df$CONSTRUCTION_NO, 2, myfun)
x=sapply(df$CONSTRUCTION_NO,myfun)
cn=df$CONSTRUCTION_NO
u_cn=unique(cn)
for i in u_cn :
for (i in u_cn) {
print(i)
}
myfun <- function(df){
cn=sort(unique(df$CONSTRUCTION_NO),ascendingggggggggggggg}
cn=sort(unique(df$CONSTRUCTION_NO),decreasing = FALSE)
for (i in cn){
df=df %>% filter(CONSTRUCTION_NO==i) %>% mutate(min_date=min(Date))
}
cn=sort(unique(df$CONSTRUCTION_NO),decreasing = FALSE)
for (i in cn){
min_date=min((df %>% filter(CONSTRUCTION_NO==i) %>% select(Date))[,1])
df=df %>% filter(CONSTRUCTION_NO==i) %>% mutate(mindate=min_date)
}
df$mindate=ifelse(df$CONSTRUCTION_NO==cn[1],min_date,NA)
min_date
min-date=min(df$Date)
min_date=min(df$Date)
min_date
df$mindate=ifelse(df$CONSTRUCTION_NO==cn[1],min_date,NA)
df$mindate=ifelse(df$CONSTRUCTION_NO==cn[1],as.Date(min_date),NA)
class(min_date)
library(tidyverse)
library(googleVis)
library(DT)
rm(list=ls())
setwd("C:\\Users\\behroozk\\Documents\\RProject\\ShinyApp\\")
rm(list=ls())
df_pavement_SHRP=read.csv("PavementStructure_SHRP_Info.csv",stringsAsFactors = FALSE)
df_pavement_info=read.csv("PavementStructure_Pavement_Info.csv")
Out_of_US=c("Alberta","British Columbia","New Brunswick","Newfoundland","Nova Scotia","Ontario","Prince Edward Island","Quebec","Saskatchewan","Manitoba")
df_pavement_info=df_pavement_info %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>%select(STATE_CODE_EXP,SHRP_ID,CONSTRUCTION_NO,LAYER_NO,LAYER_TYPE,LAYER_TYPE_EXP,REPR_THICKNESS)
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>% select(STATE_CODE_EXP,STATE_CODE,SHRP_ID,START_DATE,END_DATE)
df_pavement_info$LAYER_TYPE_EXP=str_replace(df_pavement_info$LAYER_TYPE_EXP,"layer","")
df_pavement_info=df_pavement_info %>% filter(!is.na(REPR_THICKNESS))
df_pavement_SHRP$START_DATE=as.Date(df_pavement_SHRP$START_DATE,"%m/%d/%Y")
df_pavement_SHRP$END_DATE=as.Date(df_pavement_SHRP$END_DATE,"%m/%d/%Y")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP$END_DATE=str_replace(df_pavement_SHRP$END_DATE,"2050","2005")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(duration<0))
df_pavement_SHRP=df_pavement_SHRP %>% group_by(STATE_CODE_EXP,STATE_CODE,SHRP_ID) %>% summarise(syear=min(as.integer(substr(START_DATE,1,4))),eyear=max(as.integer(substr(END_DATE,1,4))),duration=sum(duration))
df_pavement_info_AC=df_pavement_info %>% filter(LAYER_TYPE=='AC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
df_pavement_info_PC=df_pavement_info %>% filter(LAYER_TYPE=='PC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
pavement_data_AC=inner_join(df_pavement_SHRP,df_pavement_info_AC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
pavement_data_PC=inner_join(df_pavement_SHRP,df_pavement_info_PC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
df_pavement_info$CN=factor(df_pavement_info$CONSTRUCTION_NO)
df_gps=read.csv('GPS.csv',stringsAsFactors = FALSE)[,c(1,2,3,4,5,9)]
df_gps=df_gps %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_gps$ELEVATION=round(df_gps$ELEVATION,digits=2)
state_list=unique(df_pavement_info$STATE_CODE_EXP)
state_list=sort(state_list,decreasing = FALSE)
layer_type_list=sort(unique(df_pavement_info$LAYER_TYPE))
df_mera_shrp=read.csv("MERA_SHRP.csv",stringsAsFactors = FALSE)
df_mera_temp_month=read.csv("MERRA_TEMP_MONTH.csv",stringsAsFactors = FALSE)
df_mera_temp_month=df_mera_temp_month %>% select(!FREEZE_INDEX & !FREEZE_THAW)
df_mera_temp_month=df_mera_temp_month %>% mutate(Tave_F=1.8*TEMP_AVG+32)
df_mera_temp_month=df_mera_temp_month %>% select(!TEMP_AVG & !TEMP_MEAN_AVG)
df_temperature=inner_join(df_mera_shrp,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_temperature=inner_join(df_temperature,df_mera_temp_month,by="MERRA_ID")
temperature_state_list=sort(unique(df_temperature$STATE_CODE_EXP),decreasing = FALSE)
temperature_year_list=sort(unique(df_temperature$YEAR),decreasing = FALSE)
temperature_month_number_list=sort(unique(df_temperature$MONTH),decreasing = FALSE)
temperature_month_list=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')
df_traffic=read.csv("Traffic.csv",stringsAsFactors = FALSE)[,seq(1,6)]
df_traffic=df_traffic %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_traffic=inner_join(df_traffic,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_traffic=df_traffic %>% mutate(LatLong=paste(LATITUDE,LONGITUDE,sep=":"))
colnames(df_traffic)[6]="ESAL"
traffic_state=sort(unique(df_traffic$STATE_CODE_EXP),decreasing = FALSE)
traffic_year=sort(unique(df_traffic$YEAR),decreasing = FALSE)
traffic_SHRP=sort(unique(df_traffic$SHRP_ID))
df_IRI=read.csv("IRI.csv",stringsAsFactors = FALSE)
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US)) %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH,CONSTRUCTION_NO)
df_IRI=df_IRI %>% mutate(IRI_ave=ave(IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH))
df_IRI$VISIT_DATE=as.Date(df_IRI$VISIT_DATE,format ="%m/%d/%Y")
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID) %>% arrange(VISIT_DATE,CONSTRUCTION_NO)
df_IRI=df_IRI %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO,IRI_ave)
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO) %>% summarise(IRI=mean(IRI_ave),Date=min(VISIT_DATE))
df_IRI=df_IRI %>% filter(!is.na(IRI))
IRI_state=sort(unique(df_IRI$STATE_CODE_EXP))
IRI_shrp=unique((df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(SHRP_ID))[,1])
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama',SHRP_ID=='0101')
View(df)
min_date=min(df$Date)
min_date
df$day=as.integer(df$Date-min_date)
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama')
df=df_IRI %>% filter(STATE_CODE_EXP=='Alabama',SHRP_ID=='0102')
min_date=min(df$Date)
df$day=df$Date-min_date
df$day=as.integer(df$Date-min_date)
ggplot(df)+geom_point(aes(x=day,y=IRI),color=CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI),color=df$CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI),color=CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI),color=df$CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI,color=df$CONSTRUCTION_NO))
ggplot(df)+geom_point(aes(x=day,y=IRI),color=df$CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI,color=df$CONSTRUCTION_NO))+scale_fill_discrete(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI,color=df$CONSTRUCTION_NO))+scale_fill_continuous(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI,size=df$CONSTRUCTION_NO))+scale_fill_continuous(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI),size=df$CONSTRUCTION_NO)
ggplot(df)+geom_point(aes(x=day,y=IRI,size=df$CONSTRUCTION_NO))+scale_fill_continuous(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI,size=factor(df$CONSTRUCTION_NO)))+scale_fill_continuous(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI,color=factor(df$CONSTRUCTION_NO)))+scale_fill_discrete(name = "New Legend Title")
ggplot(df)+geom_point(aes(x=day,y=IRI,color=factor(df$CONSTRUCTION_NO)))+guides(fill=guide_legend(title="New Legend Title"))
ggplot(df)+geom_point(aes(x=day,y=IRI,color=factor(df$CONSTRUCTION_NO)))+labs(color='TEst')
View(df_temperature)
x=format(df_IRI$Date,'%Y')
x[2]
class(x)
x=as.integer(x)
class(x)
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
View(df1)
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI) %>% group_by(SHRP_ID) %>% summarise(min_date=min(Date))
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI) %>% group_by(SHRP_ID) %>% summarise(min_date=min(Date))
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI) %>% group_by(SHRP_ID) %>% summarise(day=as.integer(Date-min(Date)))
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
for (ishrp in unique(df1$SHRP_ID)) {
df$day=ifelse(df$SHRP_ID==ishrp,as.integer(df$Date-min(df$Date)),NA)
}
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),NA)
}
ishrp
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),NA)
print(ishrp)
}
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),NA)
}
df1$day=NA
for (ishrp in unique(df1$SHRP_ID)) {
df1=df1 %>% filter(df1$CONSTRUCTION_NO==ishrp) %>% mutate(day=1)
}
for (ishrp in unique(df1$SHRP_ID)) {
(df1 %>% filter(df1$CONSTRUCTION_NO==ishrp))[,8]=as.integer(df1$Date-min(df1$Date))
}
for (ishrp in unique(df1$SHRP_ID)) {
(df1 %>% filter(CONSTRUCTION_NO==ishrp))[,8]=as.integer(df1$Date-min(df1$Date))
}
for (ishrp in unique(df1$SHRP_ID)) {
df2=df1 %>% filter(CONSTRUCTION_NO==ishrp)
df2$day=as.integer(df2$Date-min(df2$Date))
}
View(df2)
ishrp
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
df1 %>% filter(CONSTRUCTION_NO==ishrp)
ishrp
df1$day=NA
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
}
df2=df1 %>% filter(day==0)
View(df2)
unique(CONSTRUCTION_NO)
unique(df1$CONSTRUCTION_NO)
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
df1$day=NA
x=unique(df1$SHRP_ID)
length(x)
for (ishrp in unique(df1$SHRP_ID)) {
df1=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
}
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
}
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
}
ishrp
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
df1$day=NA
for (ishrp in unique(df1$SHRP_ID)) {
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min(df1$Date)),df1$day)
}
x=df1 %>% filter(SHRP_ID=='0101')
View(x)
df1$day=ifelse(df1$SHRP_ID=='0101',as.integer(df1$Date-min(df1$Date)),df1$day)
x=df1 %>% filter(SHRP_ID=='0101')
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
for (ishrp in unique(df1$SHRP_ID)) {
}
df1$day=NA
for (ishrp in unique(df1$SHRP_ID)) {
min_date=min((df1 %>% filter(STATE_CODE_EXP==ishrp) %>% select(Date))[,1])
df1$day=ifelse(df1$SHRP_ID))))))))))))))))))))))}
for (ishrp in unique(df1$SHRP_ID)) {
min_date=min((df1 %>% filter(SHRP_ID==ishrp) %>% select(Date))[,1])
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(Date-min_date),df1$day)
}
for (ishrp in unique(df1$SHRP_ID)) {
min_date=min((df1 %>% filter(SHRP_ID==ishrp) %>% select(Date))[,1])
df1$day=ifelse(df1$SHRP_ID==ishrp,as.integer(df1$Date-min_date),df1$day)
}
x=df1 %>% filter(day==0)
dim(x)
ishrp
x=df1$SHRP_ID=='C350'
df1[x,day]
df1[x,'day']
df1[x,'day']=as.integer(df1[x,'Date']-min(df1[x,'Date']))
ishrp
df1$day=0
df1[df1$SHRP_ID==ishrp,'day']=as.integer(df1[df1$SHRP_ID==ishrp,'Date']-min(df1[df1$SHRP_ID==ishrp,'Date']))
x=as.integer(df1[df1$SHRP_ID==ishrp,'Date']-min(df1[df1$SHRP_ID==ishrp,'Date']))
x=(df1[df1$SHRP_ID==ishrp,'Date']-min(df1[df1$SHRP_ID==ishrp,'Date']))
x=(min(df1[df1$SHRP_ID==ishrp,'Date']))
x=df1[df1$SHRP_ID==ishrp,'Date']
View(x)
min(x)
min(x[,1])
min(x$Date)
min(df1[df1$SHRP_ID==ishrp,'Date'][,1])
min(df1[df1$SHRP_ID==ishrp,'Date']$Date)
df1[df1$SHRP_ID==ishrp,'day']=as.integer(df1[df1$SHRP_ID==ishrp,'Date']-min(df1[df1$SHRP_ID==ishrp,'Date']$Date)
)
min(df1[df1$SHRP_ID==ishrp,'Date']$Date)
x=df1[df1$SHRP_ID==ishrp,'Date']$Date
x=df1[df1$SHRP_ID==ishrp,'Date']$Date-min(df1[df1$SHRP_ID==ishrp,'Date']$Date)
x=as.integer(df1[df1$SHRP_ID==ishrp,'Date']$Date-min(df1[df1$SHRP_ID==ishrp,'Date']$Date))
df1[df1$SHRP_ID==ishrp,'day']$day=as.integer(df1[df1$SHRP_ID==ishrp,'Date']$Date-min(df1[df1$SHRP_ID==ishrp,'Date']$Date))
for (ishrp in unique(df1$SHRP_ID)) {
df1[df1$SHRP_ID==ishrp,'day']$day=as.integer(df1[df1$SHRP_ID==ishrp,'Date']$Date-min(df1[df1$SHRP_ID==ishrp,'Date']$Date))
}
View(df_temperature)
shiny::runApp()
library(tidyverse)
library(googleVis)
library(DT)
rm(list=ls())
setwd("C:\\Users\\behroozk\\Documents\\RProject\\ShinyApp\\")
rm(list=ls())
df_pavement_SHRP=read.csv("PavementStructure_SHRP_Info.csv",stringsAsFactors = FALSE)
df_pavement_info=read.csv("PavementStructure_Pavement_Info.csv")
Out_of_US=c("Alberta","British Columbia","New Brunswick","Newfoundland","Nova Scotia","Ontario","Prince Edward Island","Quebec","Saskatchewan","Manitoba")
df_pavement_info=df_pavement_info %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>%select(STATE_CODE_EXP,SHRP_ID,CONSTRUCTION_NO,LAYER_NO,LAYER_TYPE,LAYER_TYPE_EXP,REPR_THICKNESS)
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(STATE_CODE_EXP %in% Out_of_US))%>% select(STATE_CODE_EXP,STATE_CODE,SHRP_ID,START_DATE,END_DATE)
df_pavement_info$LAYER_TYPE_EXP=str_replace(df_pavement_info$LAYER_TYPE_EXP,"layer","")
df_pavement_info=df_pavement_info %>% filter(!is.na(REPR_THICKNESS))
df_pavement_SHRP$START_DATE=as.Date(df_pavement_SHRP$START_DATE,"%m/%d/%Y")
df_pavement_SHRP$END_DATE=as.Date(df_pavement_SHRP$END_DATE,"%m/%d/%Y")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP$END_DATE=str_replace(df_pavement_SHRP$END_DATE,"2050","2005")
df_pavement_SHRP$duration=as.integer(substr(df_pavement_SHRP$END_DATE,1,4))-as.integer(substr(df_pavement_SHRP$START_DATE,1,4))
df_pavement_SHRP=df_pavement_SHRP %>% filter(!(duration<0))
df_pavement_SHRP=df_pavement_SHRP %>% group_by(STATE_CODE_EXP,STATE_CODE,SHRP_ID) %>% summarise(syear=min(as.integer(substr(START_DATE,1,4))),eyear=max(as.integer(substr(END_DATE,1,4))),duration=sum(duration))
df_pavement_info_AC=df_pavement_info %>% filter(LAYER_TYPE=='AC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
df_pavement_info_PC=df_pavement_info %>% filter(LAYER_TYPE=='PC') %>% group_by(STATE_CODE_EXP,SHRP_ID) %>% summarise(th=sum(REPR_THICKNESS))
pavement_data_AC=inner_join(df_pavement_SHRP,df_pavement_info_AC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
pavement_data_PC=inner_join(df_pavement_SHRP,df_pavement_info_PC,by.x=c('STATE_CODE_EXP','SHRP_ID'),by.y=c('STATE_CODE_EXP','SHRP_ID'))
df_pavement_info$CN=factor(df_pavement_info$CONSTRUCTION_NO)
df_gps=read.csv('GPS.csv',stringsAsFactors = FALSE)[,c(1,2,3,4,5,9)]
df_gps=df_gps %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_gps$ELEVATION=round(df_gps$ELEVATION,digits=2)
state_list=unique(df_pavement_info$STATE_CODE_EXP)
state_list=sort(state_list,decreasing = FALSE)
layer_type_list=sort(unique(df_pavement_info$LAYER_TYPE))
df_mera_shrp=read.csv("MERA_SHRP.csv",stringsAsFactors = FALSE)
df_mera_temp_month=read.csv("MERRA_TEMP_MONTH.csv",stringsAsFactors = FALSE)
df_mera_temp_month=df_mera_temp_month %>% select(!FREEZE_INDEX & !FREEZE_THAW)
df_mera_temp_month=df_mera_temp_month %>% mutate(Tave_F=1.8*TEMP_AVG+32)
df_mera_temp_month=df_mera_temp_month %>% select(!TEMP_AVG & !TEMP_MEAN_AVG)
df_temperature=inner_join(df_mera_shrp,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_temperature=inner_join(df_temperature,df_mera_temp_month,by="MERRA_ID")
temperature_state_list=sort(unique(df_temperature$STATE_CODE_EXP),decreasing = FALSE)
temperature_year_list=sort(unique(df_temperature$YEAR),decreasing = FALSE)
temperature_month_number_list=sort(unique(df_temperature$MONTH),decreasing = FALSE)
temperature_month_list=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')
df_traffic=read.csv("Traffic.csv",stringsAsFactors = FALSE)[,seq(1,6)]
df_traffic=df_traffic %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_traffic=inner_join(df_traffic,df_gps,by.x=c("STATE_CODE","SHRP_ID"),by.y=c("STATE_CODE","SHRP_ID"))
df_traffic=df_traffic %>% mutate(LatLong=paste(LATITUDE,LONGITUDE,sep=":"))
colnames(df_traffic)[6]="ESAL"
traffic_state=sort(unique(df_traffic$STATE_CODE_EXP),decreasing = FALSE)
traffic_year=sort(unique(df_traffic$YEAR),decreasing = FALSE)
traffic_SHRP=sort(unique(df_traffic$SHRP_ID))
df_IRI=read.csv("IRI.csv",stringsAsFactors = FALSE)
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US))
df_IRI=df_IRI %>% filter(!(STATE_CODE_EXP %in% Out_of_US)) %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH,CONSTRUCTION_NO)
df_IRI=df_IRI %>% mutate(IRI_ave=ave(IRI_LEFT_WHEEL_PATH,IRI_RIGHT_WHEEL_PATH))
df_IRI$VISIT_DATE=as.Date(df_IRI$VISIT_DATE,format ="%m/%d/%Y")
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID) %>% arrange(VISIT_DATE,CONSTRUCTION_NO)
df_IRI=df_IRI %>% select(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO,IRI_ave)
df_IRI=df_IRI %>% group_by(STATE_CODE,STATE_CODE_EXP,SHRP_ID,VISIT_DATE,CONSTRUCTION_NO) %>% summarise(IRI=mean(IRI_ave),Date=min(VISIT_DATE))
df_IRI=df_IRI %>% filter(!is.na(IRI))
IRI_state=sort(unique(df_IRI$STATE_CODE_EXP))
IRI_shrp=unique((df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(SHRP_ID))[,1])
df1=df_IRI %>% filter(STATE_CODE_EXP=='Alabama') %>% select(Date,CONSTRUCTION_NO,SHRP_ID,IRI)
df1$day=NA
df2=df1 %>% group_by(SHRP_ID) %>% summarise(min_year=min(Date),max_year=max(Date))
View(df2)
df2=df1 %>% group_by(SHRP_ID) %>% summarise(min_year=min(format(Date,'%Y')),max_year=max(format(Date,'%Y')))
df3= df1 %>% mutate(survey_year=format(df1$VISIT_DATE,'%Y')) %>% group_by(SHRP_ID,survey_year) %>% summarise(max_IRI=max(IRI))
df1$survey_date=format(df1$VISIT_DATE,'%Y')
df3= df1 %>% group_by(SHRP_ID,survey_year) %>% summarise(max_IRI=max(IRI))
df3= df1 %>% group_by(SHRP_ID,survey_date) %>% summarise(max_IRI=max(IRI))
View(df3)
df4=df_temperature %>% filter(STATE_CODE_EXP==input$IRI_state_2) %>% group_by(SHRP_ID,YEAR) %>% summarise(Tave=mean(Tave_F))
df4=df_temperature %>% filter(STATE_CODE_EXP=='Alabama') %>% group_by(SHRP_ID,YEAR) %>% summarise(Tave=mean(Tave_F))
View(df4)
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
View(df5)
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
19*19
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
colnames(df3)
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
df5=left_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
class(df3$survey_date)
class(df4$YEAR)
df3$survey_date=as.integer(df3$survey_date)
class(df3$survey_date)
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
df5=inner_join(df3,df4,by.x=c('SHRP_ID','survey_date'),by.y=c('SHRP_ID','YEAR'))
class(df3$SHRP_ID)
class(df3$survey_date)
class(df4$SHRP_ID)
class(df4$YEAR)
df5=inner_join(df3,df4,by=c('SHRP_ID'='SHRP_ID','survey_date'='YEAR'))
ggplot(df5) + geom_point(aes(x=Tave,y=max_IRI,color=factor(SHRP_ID)),size=3)
